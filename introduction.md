# 스티비 API 및 웹훅 가이드

## 개요

스티비 API 및 웹훅을 사용하면 여러분의 서비스와 스티비를 연동하여 더욱 확장된 기능을 경험할 수 있습니다. 이 문서는 스티비 API의 요청 및 응답 방법을 상세히 설명합니다.

## 스티비 API 이해하기

스티비 API를 사용하면 여러분의 DB 또는 서비스와 스티비를 효과적으로 연동할 수 있습니다. 다음과 같은 활용 방법이 가능합니다:

- **DB 연동**: 여러분의 기존 고객 DB를 스티비 주소록과 연동하여 사용할 수 있습니다.
- **통계 조회**: 발송한 이메일의 통계를 스티비에 로그인하지 않고 외부에서 조회하고 원하는 대시보드로 구성할 수 있습니다.
- **자동 이메일 발송**: 서비스에서 특정 이벤트가 발생할 때마다 자동으로 이메일을 발송할 수 있습니다.

## 요금제별 API 사용 권한

| 요금제 | 구독자 | 이메일, 그룹 | 주소록, 발신자 주소 |
|--------|--------|--------------|---------------------|
| 스탠다드 | ✅ | - | - |
| 프로 | ✅ | ✅ | - |
| 엔터프라이즈 | ✅ | ✅ | ✅ |

- **구독자**: 구독자 추가, 업데이트 등 구독자 관리를 자동화해 내 고객 DB와 연동할 수 있습니다.
- **이메일, 그룹**: 이메일 발송, 관리를 자동화해 스티비에 로그인하지 않고 이메일을 만들고 발송할 수 있습니다.
- **주소록, 발신자 주소**: 주소록 관리와 발신자 이메일 주소 관리를 자동화해 스티비에 로그인하지 않고 주소록을 만들고 발신자 주소를 추가할 수 있습니다.

## API 기본 정보

### Base URL
모든 API 요청의 base URL은 `https://api.stibee.com/v2` 입니다.

```
예시: GET https://api.stibee.com/v2/emails
```

### 인증
모든 API 요청은 인증을 위해 AccessToken 헤더가 필요합니다. AccessToken은 스티비 서비스의 [워크스페이스 설정] > [API 키]에서 생성할 수 있습니다.

```
GET /emails
AccessToken: abcdefg1234
```

### API 요청 속도 제한

| API | 속도 제한 |
|-----|-----------|
| 주소록 구독자 대량 추가 | 최대 10회/분 |
| 구독자 목록 조회 | 최대 100회/분 |
| 그 외 모든 API | 최대 1000회/분 |

### 응답 형식
모든 API 응답은 JSON 형식으로 반환됩니다.

### 오류 응답
서버가 정상적으로 운영되는 상황에서는 `200 OK`와 `400 Bad Request`만 응답됩니다. `5XX` 오류 코드는 서버 장애 상황으로 인지하여 재시도 처리가 필요합니다.

```json
{
  "code": "Errors.Data.InvalidRequest",
  "httpStatusCode": 400,
  "message": "잘못된 요청입니다."
}
```

## 스티비 웹훅 이해하기

웹훅을 사용하면 주소록에서 이벤트가 발생했을 때 여러분의 서버로 실시간 알림을 받을 수 있습니다. 다음과 같은 활용 방법이 가능합니다:

- **구독 상태 동기화**: 스티비에서 구독자가 수신거부하면 여러분의 DB에도 해당 정보를 자동으로 업데이트할 수 있습니다.
- **구독자 정보 변경 동기화**: 구독자가 페이지에서 자신의 정보를 수정하면 여러분의 DB에도 수정 내용을 반영할 수 있습니다.
- **구독자 삭제 동기화**: 주소록에서 구독자를 삭제한 경우 여러분의 DB에서도 삭제 처리할 수 있습니다.

API와 웹훅을 함께 사용하면 여러분의 DB와 스티비 주소록을 완전히 동기화하여 관리할 수 있습니다.

## API 키 생성 방법

API를 사용하기 위해서는 API 키가 필요합니다. API 키 생성 방법은 다음과 같습니다:

1. 스티비 계정으로 로그인합니다.
2. 오른쪽 상단의 프로필 아이콘을 클릭합니다.
3. [워크스페이스 설정] > [API 키]로 이동합니다.
4. [API 키 만들기] 버튼을 클릭합니다.
5. API 키의 이름을 입력하고 [만들기] 버튼을 클릭합니다.
6. 생성된 API 키를 안전하게 보관합니다. 보안상의 이유로 API 키는 한 번만 표시됩니다.

## 활용 예시

### 1. 구독자 관리 자동화
```javascript
// 신규 회원 가입 시 스티비 주소록에 구독자 추가
fetch('https://api.stibee.com/v2/lists/123/subscribers', {
  method: 'POST',
  headers: {
    'AccessToken': 'YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'user@example.com',
    name: '홍길동',
    termsOfServiceAgreed: true
  })
});
```

### 2. 자동 이메일 발송
```javascript
// 주문 완료 시 자동 이메일 발송
fetch('https://api.stibee.com/v2/emails/456/send', {
  method: 'POST',
  headers: {
    'AccessToken': 'YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    subscribers: [
      {
        email: 'customer@example.com',
        name: '고객명',
        $orderNumber: 'ORDER-12345',
        $items: '상품A, 상품B'
      }
    ]
  })
});
```

### 3. 웹훅을 통한 구독 상태 동기화
웹훅 설정을 통해 구독자가 수신거부하면 여러분의 서버에 자동으로 알림이 전송됩니다. 이를 통해 여러분의 DB에서도 해당 고객의 이메일 수신 동의 상태를 업데이트할 수 있습니다.

## 자세한 API 및 웹훅 사용법

더 자세한 내용은 각 API 엔드포인트 문서와 웹훅 문서를 참고하시기 바랍니다.

- [API 사용 가이드](https://help.stibee.com/api-webhook/api)
- [웹훅 사용 가이드](https://help.stibee.com/api-webhook/list-webhook)